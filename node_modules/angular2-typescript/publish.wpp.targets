<?xml version="1.0" encoding="utf-8"?>
<!-- 
  More info at:
    https://msdn.microsoft.com/en-us/library/ee942158(v=vs.110).aspx
    http://sedodream.com/2010/05/01/WebDeploymentToolMSDeployBuildPackageIncludingExtraFilesOrExcludingSpecificFiles.aspx
-->

<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- Exclude files from being packaged -->
  <!--<PropertyGroup>
    <ExcludeFilesFromDeployment>
      .\**\*.map;
      .\**\*.ts;
      app\**\*.js;
      _references.*;
      bower.json;
      gruntfile.js;
      --><!--index.html;--><!--
      package.json;
      packages.config;
      readme.txt;
      tsd.json;
      *.targets;
      --><!--web.config--><!--
    </ExcludeFilesFromDeployment>
    <ExcludeFoldersFromDeployment>
      content;
      --><!--$(OutputPath)--><!-- Doesn't work --><!--
    </ExcludeFoldersFromDeployment>
  </PropertyGroup>-->

  <!-- Exclude files from package -->
  <Target Name="CustomExcludeFiles" BeforeTargets="ExcludeFilesFromPackage">
    <ItemGroup>
      <ExcludeFromPackageFiles Include="app\**\*.ts" />
      <ExcludeFromPackageFiles Include="app\**\*.js" />
      <ExcludeFromPackageFiles Include="app\**\*.map" />
      <ExcludeFromPackageFiles Include="index.template.html" />
      <ExcludeFromPackageFiles Include="package.json" />
      <ExcludeFromPackageFiles Include="packages.config" />
      <ExcludeFromPackageFiles Include="publish.wpp.targets" />
      <ExcludeFromPackageFiles Include="tsconfig.json" />
      <ExcludeFromPackageFiles Include="typings.json" />
      <ExcludeFromPackageFiles Include="webpack.config.js" />
      <!--<ExcludeFromPackageFiles Include="web.config" />-->
      <!--<ExcludeFromPackageFiles Include="$(OutputPath)**\*" />-->
    </ItemGroup>

    <Message Text="Configuration: $(Configuration)" />
    <Message Text="ExcludeFromPackageFiles: @(ExcludeFromPackageFiles)" Importance="high" />
  </Target>

  <!-- Include files from the publish folder -->
  <PropertyGroup>
    <PipelineCollectFilesPhaseDependsOn>
      CustomCollectFiles;
      $(PipelineCollectFilesPhaseDependsOn);
    </PipelineCollectFilesPhaseDependsOn>
  </PropertyGroup>

  <Target Name="CustomCollectFiles">
    <Message Text="Inside of CustomCollectFiles" Importance="high" />
    <ItemGroup>
      <PublishFiles Include=".\dist\**\*" />
      <FilesForPackagingFromProject Include="%(PublishFiles.Identity)">
          <DestinationRelativePath>%(RecursiveDir)dist\%(Filename)%(Extension)</DestinationRelativePath>
      </FilesForPackagingFromProject>
    </ItemGroup>
    <Message Text="CustomCollectFiles: @(PublishFiles)" Importance="high" />
  </Target>
</Project>


